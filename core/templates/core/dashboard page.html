{% load static %}
{% load i18n %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% trans "Dashboard" %} - E.T.C. CAM</title>
    <link rel="icon" type="image/png" href="{% static 'img/ETC_LOGO2.png' %}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        .nav-bg { background-color: #52533c; }
        .login-btn-bg { background-color: #5b913a; }
        .signup-btn-bg { background-color: #a09a8b; }
        .footer-bg { background-color: #d9d9d9; }
        .logout-btn-bg { background-color: #dc2626; }

        html { scroll-behavior: smooth; }

        body {
            background-image: url('{% static "img/background.jpg" %}');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            margin: 0;
            font-family: 'Inter', sans-serif;
            color: #333;
        }
        body::before {
            content: "";
            position: fixed;
            inset: 0;
            background: rgba(255, 255, 255, 0.9);
            z-index: -1;
        }

        .nav-link {
            position: relative;
            display: inline-block;
            padding: 10px 15px;
            font-size: 1rem;
            color: white;
            text-decoration: none;
            font-weight: 500;
            background: transparent;
            border: none;
        }
        .nav-link::after {
            content: "";
            position: absolute;
            left: 50%;
            bottom: 0;
            width: 0;
            height: 3px;
            background: #d1d5db;
            border-radius: 9999px;
            transition: width 0.3s ease, left 0.3s ease;
        }
        .nav-link:hover::after {
            width: 100%;
            left: 0;
        }

        .primary-btn {
            padding: 10px 20px;
            font-size: 1rem;
            font-weight: 600;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        .primary-btn:hover {
            opacity: 0.85;
            transform: translateY(-1px);
        }

        .welcome-area {
            padding-top: calc(64px + 40px);
            background-color: white;
            padding-bottom: 32px;
        }

        .nav-logo {
            height: 10rem;
            width: auto;
            filter: drop-shadow(0 0 4px rgba(0, 0, 0, 0.4));
            flex-shrink: 0;
        }

        .mobile-menu-button {
            display: none;
            color: white;
            background-color: transparent;
            border: none;
            padding: 8px;
            flex-shrink: 0;
            cursor: pointer;
        }
        .mobile-menu {
            display: none;
            flex-direction: column;
            position: absolute;
            top: 100%;
            right: 0; left: 0;
            background: #52533c;
            border-radius: 0 0 6px 6px;
            padding: 10px 0;
            z-index: 99;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .mobile-menu.active { display: flex; }
        .mobile-menu .nav-link {
            padding: 12px 20px;
            width: 100%;
            text-align: left;
            color: white;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            font-weight: 500;
        }
        .mobile-menu .nav-link:last-child { border-bottom: none; }
        .mobile-menu .nav-link:hover,
        .mobile-menu button.nav-link:hover {
            background-color: rgba(255,255,255,0.1);
        }

        #mobile-language-options {
            display: none;
            flex-direction: column;
            background-color: #424636;
            border-top: 1px solid rgba(255,255,255,0.15);
        }
        #mobile-language-options button.nav-link {
            padding-left: 2.5rem;
            border-radius: 0 0 0.375rem 0.375rem;
            font-weight: 400;
        }
        #mobile-language-button {
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            color: white;
            font-weight: 500;
            background: transparent;
            border: none;
            padding: 12px 20px;
            font-size: 1rem;
        }
        #mobile-language-button i { transition: transform 0.3s ease; }
        #mobile-language-button[aria-expanded="true"] i {
            transform: rotate(180deg);
        }

        /* ACTION CARDS (NO IMAGES, ICONS ONLY) */
        .action-card {
            @apply flex flex-col items-center justify-between bg-white rounded-xl shadow-md px-6 py-6;
        }
        .action-icon {
            font-size: 2.5rem;
            margin-bottom: 0.75rem;
        }

        /* SCANNED DISEASE HISTORY REPORT SECTION - UPDATED LAYOUT */
        .history-container {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            margin-bottom: 3rem;
        }
        
        .history-title {
            font-size: 1.875rem;
            font-weight: 700;
            color: #1f2937;
            text-align: center;
            margin-bottom: 2.5rem;
            padding-bottom: 0.75rem;
            border-bottom: 2px solid #e5e7eb;
        }

        /* VERTICAL ALIGNMENT FOR CARDS */
        .history-vertical-grid {
            display: grid;
            grid-template-columns: repeat(1, 1fr);
            gap: 2.5rem;
        }

        /* EACH PLANT CARD */
        .plant-history-card {
            background: #f8fafc;
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid #e2e8f0;
            transition: all 0.3s ease;
        }

        .plant-history-card:hover {
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
            transform: translateY(-3px);
        }

        .plant-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #52533c;
            text-align: center;
            margin-bottom: 1.5rem;
        }

        /* CHART AND LEGEND CONTAINER */
        .chart-legend-container {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        @media (min-width: 768px) {
            .chart-legend-container {
                flex-direction: row;
                align-items: stretch;
            }
        }

        /* CHART CARD */
        .chart-card {
            flex: 1;
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 250px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        .chart-wrapper {
            width: 100%;
            max-width: 250px;
            height: 250px;
            position: relative;
            margin: 0 auto;
        }

        .chart-wrapper canvas {
            width: 100% !important;
            height: 100% !important;
        }

        /* LEGEND CARD */
        .legend-card {
            flex: 1;
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            border-left: 4px solid #5b913a;
        }

        .legend-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #e5e7eb;
        }

        .legend-list {
            max-height: 200px;
            overflow-y: auto;
            padding-right: 0.5rem;
        }

        .legend-list::-webkit-scrollbar {
            width: 6px;
        }

        .legend-list::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }

        .legend-list::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 3px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
            padding: 0.5rem;
            border-radius: 6px;
            background: #f9fafb;
            transition: background 0.2s ease;
        }

        .legend-item:hover {
            background: #f3f4f6;
        }

        .color-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .legend-label {
            flex: 1;
            font-size: 0.875rem;
            color: #4b5563;
        }

        .legend-value {
            font-size: 0.875rem;
            font-weight: 600;
            color: #1f2937;
            min-width: 40px;
            text-align: right;
        }

        .legend-percentage {
            font-size: 0.75rem;
            color: #6b7280;
            min-width: 50px;
            text-align: right;
        }

        /* VIEW HISTORY BUTTON */
        .view-history-btn-container {
            display: flex;
            justify-content: center;
            margin-top: 1rem;
        }

        .view-history-btn {
            background-color: #5b913a;
            color: white;
            padding: 0.75rem 2rem;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 180px;
        }

        .view-history-btn:hover {
            background-color: #466f2c;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(91, 145, 58, 0.25);
        }

        /* NO DATA STATE */
        .no-data-state {
            text-align: center;
            padding: 2rem;
            color: #6b7280;
        }

        .no-data-state i {
            font-size: 3rem;
            color: #d1d5db;
            margin-bottom: 1rem;
        }

        .no-data-state p {
            font-size: 1rem;
            margin: 0;
        }

        /* MODAL STYLES */
        .modal {
            display: none;
            position: fixed;
            inset: 0;
            z-index: 100;
            background-color: rgba(0,0,0,0.6);
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: #ffffff;
            padding: 1.5rem;
            border-radius: 10px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            color: #111827;
        }

        .filter-controls {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
            align-items: center;
        }
        .filter-btn {
            padding: 0.4rem 0.9rem;
            border: 2px solid #2563eb;
            background: white;
            color: #2563eb;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
        }
        .filter-btn.active,
        .filter-btn:hover {
            background: #2563eb;
            color: white;
        }
        .date-range-selector {
            display: flex;
            gap: 0.25rem;
            align-items: center;
        }
        .date-range-selector input {
            padding: 0.3rem 0.5rem;
            border-radius: 6px;
            border: 1px solid #d1d5db;
            font-size: 0.85rem;
        }

        .stats-summary {
            background: #f9fafb;
            padding: 0.75rem 1rem;
            border-radius: 6px;
            border-left: 4px solid #2563eb;
            margin-bottom: 0.75rem;
            font-size: 0.9rem;
        }

        .no-data {
            text-align: center;
            padding: 2rem 0;
            color: #6b7280;
        }
        .no-data i {
            font-size: 2.3rem;
            margin-bottom: 0.5rem;
            color: #d1d5db;
        }

        .scan-history-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 0.75rem;
            font-size: 0.85rem;
        }
        .scan-history-table th,
        .scan-history-table td {
            padding: 0.5rem 0.65rem;
            border: 1px solid #e5e7eb;
            text-align: left;
        }
        .scan-history-table th {
            background-color: #f3f4f6;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 1;
        }
        .scan-history-table tr:nth-child(even) {
            background-color: #f9fafb;
        }

        .confidence-high { color: #16a34a; font-weight: 600; }
        .confidence-medium { color: #eab308; font-weight: 600; }
        .confidence-low { color: #dc2626; font-weight: 600; }

        footer {
            background-color: #d9d9d9;
            color: #4b5563;
            text-align: center;
            padding: 1rem 0;
            font-size: 0.85rem;
        }

        @media (max-width: 768px) {
            .nav-container {
                padding: 0 1rem;
                justify-content: space-between;
            }
            .desktop-nav-links { display: none !important; }
            .mobile-menu-button { display: block; }
            .nav-logo { height: 4.5rem; }
            nav { height: 64px; }
            .welcome-area {
                padding-top: calc(64px + 30px);
                padding-bottom: 24px;
            }
            .history-container {
                padding: 1.5rem;
            }
            .plant-history-card {
                padding: 1rem;
            }
        }
        @media (min-width: 769px) {
            .desktop-nav-links { display: flex !important; }
            .mobile-menu,
            .mobile-menu-button { display: none !important; }
            .nav-container {
                padding: 0 3rem;
            }
            .history-vertical-grid {
                gap: 2rem;
            }
        }
    </style>
</head>
<body>
<nav class="fixed top-0 left-0 w-full nav-bg text-white z-50 shadow-md flex items-center h-16">
    <div class="nav-container flex items-center w-full max-w-7xl mx-auto">
        <a href="#home" class="flex items-center mr-4">
            <img src="{% static 'img/ETC_LOGO2.png' %}" alt="E.T.C. CAM Logo" class="nav-logo">
        </a>

        <div class="flex items-center gap-3 ml-auto">
            <div class="desktop-nav-links flex items-center gap-4">
                <a href="#home" class="nav-link">{% trans "HOME" %}</a>
                <a href="#scan-history" class="nav-link">{% trans "HISTORY" %}</a>
                <a href="#team" class="nav-link">{% trans "TEAM" %}</a>

                <!-- DESKTOP LANGUAGE DROPDOWN (CLICK TOGGLE) -->
                <div class="relative">
                    <button id="desktop-language-button"
                            class="bg-transparent text-white px-3 py-1 rounded hover:bg-gray-600 focus:outline-none flex items-center gap-1">
                        <i class="fas fa-globe"></i>
                        <span>{% trans "Language" %}</span>
                        <i class="fas fa-caret-down text-sm ml-1"></i>
                    </button>
                    <form id="desktop-language-menu"
                          action="{% url 'set_language' %}" method="post"
                          class="absolute right-0 mt-2 w-32 bg-gray-700 rounded-lg shadow-xl hidden">
                        {% csrf_token %}
                        <input type="hidden" name="next" value="{{ request.get_full_path }}">
                        <div class="py-1">
                            <button type="submit" name="language" value="en"
                                    class="block w-full text-left px-4 py-2 text-sm text-white hover:bg-gray-800">
                                English
                            </button>
                            <button type="submit" name="language" value="tl"
                                    class="block w-full text-left px-4 py-2 text-sm text-white hover:bg-gray-800">
                                Filipino
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <a href="#" onclick="showLogoutModal()" class="primary-btn logout-btn-bg text-white hover:opacity-85">
                {% trans "Logout" %}
            </a>

            <button class="mobile-menu-button focus:outline-none" aria-label="Toggle menu">
                <i class="fas fa-bars text-xl"></i>
            </button>
        </div>

        <!-- MOBILE MENU -->
        <div class="mobile-menu nav-bg" aria-hidden="true">
            <a href="#home" class="nav-link">{% trans "HOME" %}</a>
            <a href="#services" class="nav-link">{% trans "OUR SERVICES" %}</a>
            <a href="#scan-history" class="nav-link">{% trans "HISTORY" %}</a>
            <a href="#team" class="nav-link">{% trans "TEAM" %}</a>

            <!-- MOBILE LANGUAGE DROPDOWN -->
            <button type="button" class="nav-link" id="mobile-language-button"
                    aria-expanded="false" aria-controls="mobile-language-options">
                {% trans "Language" %}
                <i class="fas fa-caret-down"></i>
            </button>
            <div id="mobile-language-options">
                <form action="{% url 'set_language' %}" method="post" class="w-full">
                    {% csrf_token %}
                    <input type="hidden" name="next" value="{{ request.get_full_path }}">
                    <button type="submit" name="language" value="en" class="nav-link block w-full text-left">
                        {% trans "English" %}
                    </button>
                    <button type="submit" name="language" value="tl" class="nav-link block w-full text-left">
                        {% trans "Filipino" %}
                    </button>
                </form>
            </div>
        </div>
    </div>
</nav>

<!-- HERO (NO EXTRA IMAGE BEFORE ACTION CARDS) -->
<div class="welcome-area" id="home">
    <div class="max-w-5xl mx-auto px-8 text-center">
        <h1 class="text-4xl font-extrabold mb-3 text-gray-800">
            {% trans "Dear Farmer," %}
        </h1>
        <p class="text-xl mb-2 max-w-3xl mx-auto text-gray-600">
            {% trans "Welcome to E.T.C. Cam" %}
        </p>
    </div>
</div>

<!-- SERVICES / ACTION CARDS WITH ICONS -->
<section id="services" class="py-10 bg-gray-100/90">
    <div class="max-w-5xl mx-auto px-6">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <!-- 3D -->
            <div class="bg-white rounded-xl shadow-md px-6 py-6 flex flex-col items-center">
                <i class="fa-solid fa-cubes text-green-700 action-icon"></i>
                <h3 class="text-xl font-bold text-green-700 mb-1">
                    {% trans "3D Visualization" %}
                </h3>
                <p class="text-sm text-gray-600 mb-4 text-center">
                    {% trans "View your crop in 3D using augmented reality." %}
                </p>
                <a href="{% url 'ar_visualization:ar_page' %}"
                   class="primary-btn login-btn-bg text-white mt-auto">
                    {% trans "OPEN 3D" %}
                </a>
            </div>
            <!-- Scan -->
            <div class="bg-white rounded-xl shadow-md px-6 py-6 flex flex-col items-center">
                <i class="fa-solid fa-camera text-green-700 action-icon"></i>
                <h3 class="text-xl font-bold text-green-700 mb-1">
                    {% trans "Scan Diseases" %}
                </h3>
                <p class="text-sm text-gray-600 mb-4 text-center">
                    {% trans "Scan eggplant, tomato, or chili pepper for diseases." %}
                </p>
                <a href="{% url 'ar_visualization:scan_page' %}"
                   class="primary-btn login-btn-bg text-white mt-auto">
                    {% trans "START SCAN" %}
                </a>
            </div>
            <!-- List -->
            <div class="bg-white rounded-xl shadow-md px-6 py-6 flex flex-col items-center">
                <i class="fa-solid fa-list-ul text-green-700 action-icon"></i>
                <h3 class="text-xl font-bold text-green-700 mb-1">
                    {% trans "Disease List" %}
                </h3>
                <p class="text-sm text-gray-600 mb-4 text-center">
                    {% trans "Browse diseases and recommended treatments." %}
                </p>
                <a href="{% url 'list_page' %}"
                   class="primary-btn login-btn-bg text-white mt-auto">
                    {% trans "VIEW LIST" %}
                </a>
            </div>
        </div>
    </div>
</section>

<!-- HISTORY WITH PIE CHARTS - UPDATED LAYOUT -->
<section id="scan-history" class="py-10 px-4">
    <div class="max-w-6xl mx-auto">
        <div class="history-container">
            <h2 class="history-title">
                {% trans "Scanned Disease History Report" %}
            </h2>
            
            <div class="history-vertical-grid">
                <!-- Eggplant Card -->
                <div class="plant-history-card">
                    <h3 class="plant-title">{% trans "Eggplant" %}</h3>
                    
                    <div class="chart-legend-container">
                        <!-- Chart Card -->
                        <div class="chart-card">
                            <div class="chart-wrapper">
                                <canvas id="eggplantChart"></canvas>
                            </div>
                        </div>
                        
                        <!-- Legend Card -->
                        <div class="legend-card">
                            <h4 class="legend-title">{% trans "Legend" %}</h4>
                            <div id="eggplantLegend" class="legend-list"></div>
                        </div>
                    </div>
                    
                    <!-- View History Button -->
                    <div class="view-history-btn-container">
                        <button class="view-history-btn" onclick="showHistoryModal('Eggplant')">
                            {% trans "View History" %}
                        </button>
                    </div>
                </div>
                
                <!-- Tomato Card -->
                <div class="plant-history-card">
                    <h3 class="plant-title">{% trans "Tomato" %}</h3>
                    
                    <div class="chart-legend-container">
                        <!-- Chart Card -->
                        <div class="chart-card">
                            <div class="chart-wrapper">
                                <canvas id="tomatoChart"></canvas>
                            </div>
                        </div>
                        
                        <!-- Legend Card -->
                        <div class="legend-card">
                            <h4 class="legend-title">{% trans "Legend" %}</h4>
                            <div id="tomatoLegend" class="legend-list"></div>
                        </div>
                    </div>
                    
                    <!-- View History Button -->
                    <div class="view-history-btn-container">
                        <button class="view-history-btn" onclick="showHistoryModal('Tomato')">
                            {% trans "View History" %}
                        </button>
                    </div>
                </div>
                
                <!-- Chili Pepper Card -->
                <div class="plant-history-card">
                    <h3 class="plant-title">{% trans "Chili Pepper" %}</h3>
                    
                    <div class="chart-legend-container">
                        <!-- Chart Card -->
                        <div class="chart-card">
                            <div class="chart-wrapper">
                                <canvas id="chiliChart"></canvas>
                            </div>
                        </div>
                        
                        <!-- Legend Card -->
                        <div class="legend-card">
                            <h4 class="legend-title">{% trans "Legend" %}</h4>
                            <div id="chiliLegend" class="legend-list"></div>
                        </div>
                    </div>
                    
                    <!-- View History Button -->
                    <div class="view-history-btn-container">
                        <button class="view-history-btn" onclick="showHistoryModal('Chili Pepper')">
                            {% trans "View History" %}
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- TEAM (unchanged from your landing style) -->
<section id="team" class="py-16">
    <div class="max-w-5xl mx-auto p-8 bg-white/90 rounded-lg shadow-xl">
        <h2 class="text-3xl font-bold text-gray-800 mb-10 border-b pb-2 text-center">
            {% trans "Meet the team that is behind this successful project." %}
        </h2>
        <div class="space-y-8">
            <!-- Jelah -->
            <div class="flex flex-col md:flex-row items-center content-card p-6 shadow-md border border-gray-100">
                <img src="{% static 'img/jelah_id-pic.png' %}" alt="Jelah Quintana"
                     class="w-40 h-40 object-cover rounded-full md:mr-6 mb-4 md:mb-0 border-4 border-green-500">
                <div class="text-center md:text-left flex-grow">
                    <h3 class="text-xl font-bold text-gray-900 mb-1">{% trans "Jelah Quintana" %}</h3>
                    <p class="text-lg font-semibold text-green-700 mb-1">
                        {% trans "Project Leader, Lead Programmer" %}
                    </p>
                    <p class="text-sm text-gray-600 mt-2">
                        {% trans "Meet Ms. Jelah Joy L. Quintana, the Project Leader. She is the Backend Developer of this project. The mastermind behind the functionality of how the users interact with this web app." %}
                    </p>
                    <p class="text-sm font-semibold text-green-700 mb-1 mt-3">
                        {% trans "Contact Information:" %}
                    </p>
                    <p class="text-sm text-gray-500 mb-1">Email: jelahquintana@gmail.com</p>
                    <p class="text-sm text-gray-500 mb-1">
                        {% trans "Phone Number: 0995 531 9453" %}
                    </p>
                    <p class="text-sm text-gray-700">
                            <a href="https://www.facebook.com/share/17X7R5KLtd/" target="_blank" class="text-blue-600 hover:underline flex items-center justify-center md:justify-start">
                                <i class="fab fa-facebook-square mr-1"></i> Jelah Quintana
                            </a>
                    </p>
                </div>
            </div>

            <!-- Catherine -->
            <div class="flex flex-col md:flex-row-reverse items-center content-card p-6 shadow-md border border-gray-100">
                <img src="{% static 'core/static/img/cath-2.png' %}" alt="Catherine Capillano"
                     class="w-40 h-40 object-cover rounded-full md:mr-6 mb-4 md:mb-0 border-4 border-green-500">
                <div class="text-center md:text-right flex-grow">
                    <h3 class="text-xl font-bold text-gray-900 mb-1">{% trans "Catherine Capillano" %}</h3>
                    <p class="text-lg font-semibold text-green-700 mb-1">
                        {% trans "UI/UX Designer, System Analyst" %}
                    </p>
                    <p class="text-sm text-gray-600 mt-2">
                        {% trans "Meet Ms. Catherine L. Capillano, the System Analyst. She is also the Frontend Developer of this project, responsible for building an intuitive and user-friendly interface." %}
                    </p>
                    <p class="text-sm font-semibold text-green-700 mb-1 mt-3">
                        {% trans "Contact Information:" %}
                    </p>
                    <p class="text-sm text-gray-500 mb-1">Email: catherinecapillano281@gmail.com</p>
                    <p class="text-sm text-gray-500 mb-1">
                        {% trans "Phone Number: 0905 356 1597" %}
                    </p>
                    <p class="text-sm text-gray-700">
                            <a href="https://www.facebook.com/share/1GrxajzhiM/" target="_blank" class="text-blue-600 hover:underline flex items-center justify-center md:justify-end">
                                <i class="fab fa-facebook-square mr-1"></i> Catherine Landicho Capillano
                            </a>
                    </p>
                </div>
            </div>

            <!-- Jake -->
            <div class="flex flex-col md:flex-row items-center content-card p-6 shadow-md border border-gray-100">
                <img src="{% static 'img/byron2.png' %}" alt="Jake Byron Orense"
                     class="w-40 h-40 object-cover rounded-full md:mr-6 mb-4 md:mb-0 border-4 border-green-500">
                <div class="text-center md:text-left flex-grow">
                    <h3 class="text-xl font-bold text-gray-900 mb-1">{% trans "Jake Byron Orense" %}</h3>
                    <p class="text-lg font-semibold text-green-700 mb-1">
                        {% trans "System Analyst" %}
                    </p>
                    <p class="text-sm text-gray-600 mt-2">
                        {% trans "Meet Mr. Jake Byron P. Orense, the Quality Assurance in charge, who focuses on monitoring the team's goals and objectives of this project to run smoothly." %}
                    </p>
                    <p class="text-sm font-semibold text-green-700 mb-1 mt-3">
                        {% trans "Contact Information:" %}
                    </p>
                    <p class="text-sm text-gray-500 mb-1">Email: orensejakebyron19@gmail.com</p>
                    <p class="text-sm text-gray-500 mb-1">
                        {% trans "Phone Number: 0991 693 2972" %}
                    </p>
                    <p class="text-sm text-gray-700">
                            <a href="https://www.facebook.com/share/16PCmMmziZ/" target="_blank" class="text-blue-600 hover:underline flex items-center justify-center md:justify-start">
                                <i class="fab fa-facebook-square mr-1"></i> Jake Byron Orense
                            </a>
                    </p>
                </div>
            </div>
        </div>
    </div>
</section>

<footer class="footer-bg p-4 text-center text-sm text-gray-600">
    <p>{% trans "Brought to you by BSIT 4th Year - Capstone Project - Group 3" %}</p>
    <p>&copy; {% now "Y" %} E.T.C. Cam. {% trans "All Rights Reserved" %}.</p>
</footer>

<!-- MODALS (same behavior as before) -->
<div id="logoutModal" class="modal">
    <div class="modal-content max-w-sm">
        <p class="mb-4 text-center text-base">
            {% trans "Are you sure you want to logout?" %}
        </p>
        <div class="flex justify-center gap-3">
            <button style="background-color: #dc2626;" class="primary-btn text-white" onclick="confirmLogout()">
                {% trans "YES" %}
            </button>
            <button style="background-color: #6b7280;" class="primary-btn text-white" onclick="hideLogoutModal()">
                {% trans "NO" %}
            </button>
        </div>
    </div>
</div>

<div id="scanHistoryModal" class="modal">
    <div class="modal-content">
        <h3 id="scanHistoryModalTitle" class="text-lg font-bold mb-4 text-gray-800"></h3>
        <div class="filter-controls">
            <button class="filter-btn active" onclick="setFilter(event, 'all')">
                {% trans "All Time" %}
            </button>
            <button class="filter-btn" onclick="setFilter(event, 'today')">
                {% trans "Today" %}
            </button>
            <button class="filter-btn" onclick="setFilter(event, 'week')">
                {% trans "This Week" %}
            </button>
            <button class="filter-btn" onclick="setFilter(event, 'month')">
                {% trans "This Month" %}
            </button>
            <div class="date-range-selector">
                <input type="date" id="startDate" onchange="setCustomDateRange()">
                <span>{% trans "to" %}</span>
                <input type="date" id="endDate" onchange="setCustomDateRange()">
            </div>
            <button class="filter-btn" onclick="clearFilters()">
                {% trans "Clear Filters" %}
            </button>
        </div>

        <div id="statsSummary" class="stats-summary">
            <p><strong>{% trans "Total Scans:" %} <span id="totalScans">0</span></strong></p>
            <p>{% trans "Diseases Detected:" %} <span id="diseasesDetected">0</span></p>
            <p>{% trans "Healthy Plants:" %} <span id="healthyPlants">0</span></p>
        </div>

        <div id="scanHistoryTableContainer">
            <div class="no-data">
                <i class="fas fa-history"></i>
                <p>{% trans "No scan history available for this plant." %}</p>
            </div>
        </div>

        <div class="flex justify-end mt-4">
            <button onclick="printHistory()"
                    class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded mr-2">
                {% trans "Print" %}
            </button>
            <button onclick="hideHistoryModal()"
                    class="bg-gray-300 hover:bg-red-400 text-gray-800 font-bold py-2 px-4 rounded">
                {% trans "Close" %}
            </button>
        </div>
    </div>
</div>

<script>
    // MOBILE MENU + LANGUAGE
    document.addEventListener('DOMContentLoaded', function () {
        const mobileMenuButton = document.querySelector('.mobile-menu-button');
        const mobileMenu = document.querySelector('.mobile-menu');
        const mobileLangButton = document.getElementById('mobile-language-button');
        const mobileLangOptions = document.getElementById('mobile-language-options');
        const desktopLangButton = document.getElementById('desktop-language-button');
        const desktopLangMenu = document.getElementById('desktop-language-menu');

        // burger
        if (mobileMenuButton && mobileMenu) {
            mobileMenuButton.addEventListener('click', () => {
                const isActive = mobileMenu.classList.toggle('active');
                mobileMenu.setAttribute('aria-hidden', !isActive);
            });
        }

        // mobile language
        if (mobileLangButton && mobileLangOptions) {
            mobileLangButton.addEventListener('click', (e) => {
                e.stopPropagation();
                const isHidden = mobileLangOptions.style.display === 'none' || mobileLangOptions.style.display === '';
                mobileLangOptions.style.display = isHidden ? 'flex' : 'none';
                mobileLangButton.setAttribute('aria-expanded', isHidden ? 'true' : 'false');
            });
        }

        // desktop language dropdown click toggle
        if (desktopLangButton && desktopLangMenu) {
            desktopLangButton.addEventListener('click', (e) => {
                e.stopPropagation();
                desktopLangMenu.classList.toggle('hidden');
            });
            document.addEventListener('click', () => {
                desktopLangMenu.classList.add('hidden');
            });
        }

        // close mobile on link click
        if (mobileMenu) {
            const clickableItems = mobileMenu.querySelectorAll('a, button[type="submit"]');
            clickableItems.forEach(item => {
                item.addEventListener('click', () => {
                    mobileMenu.classList.remove('active');
                    mobileMenu.setAttribute('aria-hidden', 'true');
                    if (mobileLangOptions && mobileLangButton) {
                        mobileLangOptions.style.display = 'none';
                        mobileLangButton.setAttribute('aria-expanded', 'false');
                    }
                });
            });
        }

        // Charts initialization
        initCharts();
    });

    function initCharts() {
        let plantData = {};
        try {
            const raw = '{{ plants_data_json|escapejs }}';
            plantData = JSON.parse(raw || '{}');
        } catch (e) {
            console.error('plants_data_json parse error', e);
            plantData = {};
        }

        const mapping = {
            'Eggplant': { canvas: 'eggplantChart', legend: 'eggplantLegend' },
            'Tomato': { canvas: 'tomatoChart', legend: 'tomatoLegend' },
            'Chili Pepper': { canvas: 'chiliChart', legend: 'chiliLegend' },
        };

        const defaultColors = [
            '#5b913a', '#ff6b6b', '#ffa726', '#42a5f5', '#ab47bc',
            '#26c6da', '#d4e157', '#8d6e63', '#78909c', '#ff7043'
        ];

        Object.keys(mapping).forEach(name => {
            const cfg = mapping[name];
            const ctx = document.getElementById(cfg.canvas);
            const legendContainer = document.getElementById(cfg.legend);
            if (!ctx || !legendContainer) return;

            const d = plantData[name];
            if (!d || !d.labels || !d.labels.length) {
                // Create empty chart
                new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['{% trans "No Scans Yet" %}'],
                        datasets: [{
                            data: [1],
                            backgroundColor: ['#e5e7eb'],
                            borderColor: '#ffffff',
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        cutout: '65%',
                        plugins: {
                            legend: { display: false },
                            tooltip: { enabled: false }
                        }
                    }
                });
                
                // Empty legend state
                legendContainer.innerHTML = `
                    <div class="no-data-state">
                        <i class="fas fa-chart-pie"></i>
                        <p>{% trans "No data available." %}</p>
                    </div>
                `;
                return;
            }

            // Use provided colors or default colors
            const colors = d.colors && d.colors.length >= d.labels.length 
                ? d.colors 
                : defaultColors.slice(0, d.labels.length);

            // Create the chart
            const chart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: d.labels,
                    datasets: [{
                        data: d.data,
                        backgroundColor: colors,
                        borderColor: '#ffffff',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    cutout: '65%',
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    const label = context.label || '';
                                    const value = context.parsed;
                                    const total = context.dataset.data.reduce((s, c) => s + c, 0);
                                    const percentage = total > 0 ? (value / total * 100).toFixed(1) : 0;
                                    return `${label}: ${value} scan${value !== 1 ? 's' : ''} (${percentage}%)`;
                                }
                            }
                        }
                    },
                    animation: {
                        animateScale: true,
                        animateRotate: true
                    }
                }
            });

            // Build legend
            const total = d.data.reduce((s, c) => s + c, 0);
            legendContainer.innerHTML = '';
            
            d.labels.forEach((label, idx) => {
                const value = d.data[idx];
                const percentage = total > 0 ? ((value / total) * 100).toFixed(1) : 0;
                
                const legendItem = document.createElement('div');
                legendItem.className = 'legend-item';
                legendItem.innerHTML = `
                    <span class="color-dot" style="background-color: ${colors[idx]}"></span>
                    <span class="legend-label">${label}</span>
                    <span class="legend-value">${value}</span>
                    <span class="legend-percentage">${percentage}%</span>
                `;
                legendContainer.appendChild(legendItem);
            });
            
            // Add total row
            const totalRow = document.createElement('div');
            totalRow.className = 'legend-item';
            totalRow.style.fontWeight = '600';
            totalRow.style.background = '#f0f9ff';
            totalRow.innerHTML = `
                <span class="color-dot" style="background-color: #52533c"></span>
                <span class="legend-label">{% trans "Total Scans" %}</span>
                <span class="legend-value">${total}</span>
                <span class="legend-percentage">100%</span>
            `;
            legendContainer.appendChild(totalRow);
        });
    }

    // MODAL + HISTORY LOGIC
    let currentPlant = '';
    let currentFilter = 'all';
    let currentScans = [];

    function showLogoutModal() {
        document.getElementById('logoutModal').style.display = 'flex';
    }
    function hideLogoutModal() {
        document.getElementById('logoutModal').style.display = 'none';
    }
    function confirmLogout() {
        window.location.href = "{% url 'logout_view' %}";
    }

    function showHistoryModal(plantName) {
        currentPlant = plantName;
        document.getElementById('scanHistoryModalTitle').textContent =
            `${plantName} {% trans "Scan History" %}`;
        document.getElementById('scanHistoryModal').style.display = 'flex';
        setFilter(null, 'all');
    }
    function hideHistoryModal() {
        document.getElementById('scanHistoryModal').style.display = 'none';
        currentPlant = '';
        currentFilter = 'all';
    }

    function setFilter(e, filterType) {
        currentFilter = filterType;
        document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
        if (e && e.target) {
            e.target.classList.add('active');
        } else {
            const first = document.querySelector('.filter-btn');
            if (first) first.classList.add('active');
        }
        loadScanHistory();
    }

    function setCustomDateRange() {
        const s = document.getElementById('startDate').value;
        const e = document.getElementById('endDate').value;
        if (s && e) {
            currentFilter = 'custom';
            loadScanHistory();
        }
    }

    function clearFilters() {
        currentFilter = 'all';
        document.getElementById('startDate').value = '';
        document.getElementById('endDate').value = '';
        document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
        const first = document.querySelector('.filter-btn');
        if (first) first.classList.add('active');
        loadScanHistory();
    }

    function loadScanHistory() {
        const container = document.getElementById('scanHistoryTableContainer');
        container.innerHTML =
            '<p class="text-gray-600">{% trans "Loading scan history..." %}</p>';

        let url = `/api/scan-history/?plant=${encodeURIComponent(currentPlant)}`;
        if (currentFilter !== 'all') url += `&filter=${currentFilter}`;
        if (currentFilter === 'custom') {
            const s = document.getElementById('startDate').value;
            const e = document.getElementById('endDate').value;
            if (s && e) url += `&start_date=${s}&end_date=${e}`;
        }

        fetch(url)
            .then(r => r.ok ? r.json() : Promise.reject(r.status))
            .then(data => {
                currentScans = data.scans || [];
                renderScanHistoryTable(currentScans);
                updateStatistics(currentScans);
            })
            .catch(() => {
                container.innerHTML =
                    `<div class="no-data">
                        <i class="fas fa-exclamation-triangle"></i>
                        <p>{% trans "Failed to load scan history." %}</p>
                     </div>`;
            });
    }

    function renderScanHistoryTable(scans) {
        const container = document.getElementById('scanHistoryTableContainer');
        if (!scans || !scans.length) {
            container.innerHTML =
                `<div class="no-data">
                    <i class="fas fa-search"></i>
                    <p>{% trans "No scan history found." %}</p>
                 </div>`;
            return;
        }
        let html = `<div class="overflow-x-auto">
            <table class="scan-history-table">
              <thead>
                <tr>
                  <th>{% trans "Date & Time" %}</th>
                  <th>{% trans "Plant Type" %}</th>
                  <th>{% trans "Disease Detected" %}</th>
                  <th>{% trans "Confidence" %}</th>
                  <th>{% trans "Status" %}</th>
                </tr>
              </thead><tbody>`;
        scans.forEach(scan => {
            const d = new Date(scan.scan_date);
            const disease = scan.disease_name || '{% trans "No Disease Detected" %}';
            const confVal = scan.confidence ? (scan.confidence * 100).toFixed(1) + '%' : 'N/A';
            const healthy = !scan.disease_name || scan.disease_name === 'Healthy';
            let cClass = '';
            if (scan.confidence) {
                if (scan.confidence >= 0.8) cClass = 'confidence-high';
                else if (scan.confidence >= 0.5) cClass = 'confidence-medium';
                else cClass = 'confidence-low';
            }
            html += `<tr>
                <td>${d.toLocaleDateString()}<br><small>${d.toLocaleTimeString()}</small></td>
                <td>${scan.plant_type || currentPlant}</td>
                <td>${disease}</td>
                <td class="${cClass}">${confVal}</td>
                <td>${healthy ? '{% trans "Healthy" %}' : '{% trans "Diseased" %}'}</td>
            </tr>`;
        });
        html += '</tbody></table></div>';
        container.innerHTML = html;
    }

    function updateStatistics(scans) {
        const total = scans.length;
        const diseases = scans.filter(s => s.disease_name && s.disease_name !== 'Healthy').length;
        const healthy = scans.filter(s => !s.disease_name || s.disease_name === 'Healthy').length;
        document.getElementById('totalScans').textContent = total;
        document.getElementById('diseasesDetected').textContent = diseases;
        document.getElementById('healthyPlants').textContent = healthy;
    }

    function printHistory() {
        if (!currentScans.length) {
            alert('{% trans "No data to print." %}');
            return;
        }
        const win = window.open('', '_blank');
        const title = document.getElementById('scanHistoryModalTitle').textContent;
        let table = `<table border="1" style="width:100%; border-collapse:collapse;">
            <thead>
            <tr style="background-color:#f2f2f2;">
                <th>Date & Time</th>
                <th>Plant Type</th>
                <th>Disease Detected</th>
                <th>Confidence</th>
                <th>Status</th>
            </tr>
            </thead><tbody>`;
        currentScans.forEach(scan => {
            const d = new Date(scan.scan_date);
            const disease = scan.disease_name || 'No Disease Detected';
            const confVal = scan.confidence ? (scan.confidence * 100).toFixed(1) + '%' : 'N/A';
            const healthy = !scan.disease_name || scan.disease_name === 'Healthy';
            table += `<tr>
                <td>${d.toLocaleDateString()} ${d.toLocaleTimeString()}</td>
                <td>${scan.plant_type || currentPlant}</td>
                <td>${disease}</td>
                <td>${confVal}</td>
                <td>${healthy ? 'Healthy' : 'Diseased'}</td>
            </tr>`;
        });
        table += '</tbody></table>';
        win.document.write(`<html><head><title>${title}</title></head>
            <body><h1>${title}</h1>${table}</body></html>`);
        win.document.close();
    }
</script>
</body>
</html>